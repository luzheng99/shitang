<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>楼庄子水库管理站食堂花名册</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: "SimSun", serif; padding: 20px; }
        h1 { text-align: center; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; table-layout: fixed; }
        th, td { border: 1px solid black; padding: 5px; text-align: center; height: 35px; vertical-align: middle; }
        th { background-color: #f2f2f2; font-weight: bold; }
        
        /* Input Styles */
        input { font-family: inherit; font-size: inherit; background-color: transparent; border: none; text-align: center; width: 100%; height: 100%; }
        input:focus { background-color: #e0e0e0; outline: none; }
        
        /* Specific Inputs */
        input.month-input { width: 40px; border-bottom: 1px solid black; height: auto; display: inline-block; vertical-align: baseline; }
        
        /* Highlight editable cells */
        td.editable { background-color: #f9f9f9; padding: 0; }
        
        tfoot td { font-weight: bold; }
        
        /* Column Widths */
        col.index { width: 40px; }
        col.name { width: 90px; }
        col.days { width: 70px; }
        col.subsidy { width: 70px; }
        col.note { width: auto; }

        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            body { padding: 0; }
            th { background-color: #f2f2f2 !important; -webkit-print-color-adjust: exact; }
            td.editable { background-color: transparent !important; }
            input { border: none; }
            input.month-input { border-bottom: none; }
        }
    </style>
</head>
<body>

    <div class="no-print" style="text-align: center; margin-bottom: 20px;">
        <button onclick="downloadExcel()" style="padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px;">下载表格 (Excel)</button>
        <p style="font-size: 14px; color: #666; margin-top: 5px;">提示：点击上方按钮将下载当前填写内容的 Excel 文件。</p>
    </div>

    <h1>楼庄子水库管理站食堂花名册(<input type="text" class="month-input" id="monthInput">)月</h1>

    <table id="rosterTable">
        <colgroup>
            <!-- Left Side -->
            <col class="index">
            <col class="name">
            <col class="days">
            <col class="subsidy">
            <col class="note">
            <!-- Right Side -->
            <col class="index">
            <col class="name">
            <col class="days">
            <col class="subsidy">
            <col class="note">
        </colgroup>
        <thead>
            <tr>
                <th>序号</th>
                <th>姓名</th>
                <th>在岗天数</th>
                <th>补助(元)</th>
                <th>备注</th>
                <th>序号</th>
                <th>姓名</th>
                <th>在岗天数</th>
                <th>补助(元)</th>
                <th>备注</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Rows will be generated by JS -->
        </tbody>
        <tfoot>
            <tr>
                <td colspan="5" style="text-align: left; padding-left: 10px;">站领导签字:</td>
                <td>报账员:</td>
                <td></td>
                <td>合计</td>
                <td id="grandTotal">0</td>
                <td></td>
            </tr>
        </tfoot>
    </table>

    <script>
        const dailySubsidy = 27;

        // Data from the Excel (Removed notes as requested to be empty by default)
        // Left side data (indices 0-19 correspond to ID 1-20)
        const leftData = [
            { id: 1, name: "赵海宏", days: 25 },
            { id: 2, name: "袁剑", days: 24 },
            { id: 3, name: "赵堃", days: 22 },
            { id: 4, name: "马军", days: 17 },
            { id: 5, name: "桑盛国", days: 13 },
            { id: 6, name: "阿巴别克尔.克里木", days: 22 },
            { id: 7, name: "阿克卓力.阿达力", days: 22 },
            { id: 8, name: "徐建红", days: 25 },
            { id: 9, name: "芦峥", days: 22 },
            { id: 10, name: "方世江", days: 22 },
            { id: 11, name: "王瑞海", days: 22 },
            { id: 12, name: "余才林", days: 22 },
            { id: 13, name: "陈彦韬", days: 22 },
            { id: 14, name: "张宸海", days: 22 },
            { id: 15, name: "杨鹏", days: 12 },
            { id: 16, name: "马文雅", days: 22 },
            { id: 17, name: "发如合.斯马义", days: 17 },
            { id: 18, name: "雷玉珠", days: 22 },
            { id: 19, name: "管宁", days: 22 },
            { id: 20, name: "聂西", days: 9 }
        ];

        // Right side data (indices 0-2 correspond to ID 21-23)
        const rightData = [
            { id: 21, name: "巴丽江.努尔兰太", days: 0 },
            { id: 22, name: "王焕龙", days: 0 },
            { id: 23, name: "努尔比娅.买买提", days: 0 }
        ];

        const tbody = document.getElementById('tableBody');
        const maxRows = Math.max(leftData.length, rightData.length);

        for (let i = 0; i < maxRows; i++) {
            const tr = document.createElement('tr');
            
            // Left Side
            if (i < leftData.length) {
                const item = leftData[i];
                tr.innerHTML += `
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td class="editable"><input type="number" value="${item.days}" min="0" step="0.5" oninput="calculate(this, 'left_${i}')" id="days_left_${i}"></td>
                    <td id="subsidy_left_${i}">${item.days * dailySubsidy}</td>
                    <td class="editable"><input type="text" value="" id="note_left_${i}"></td>
                `;
            } else {
                tr.innerHTML += `<td></td><td></td><td></td><td></td><td></td>`;
            }

            // Right Side
            if (i < rightData.length) {
                const item = rightData[i];
                tr.innerHTML += `
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td class="editable"><input type="number" value="${item.days === 0 ? '' : item.days}" min="0" step="0.5" oninput="calculate(this, 'right_${i}')" id="days_right_${i}"></td>
                    <td id="subsidy_right_${i}">${item.days * dailySubsidy}</td>
                    <td class="editable"><input type="text" value="" id="note_right_${i}"></td>
                `;
            } else {
                 tr.innerHTML += `<td></td><td></td><td></td><td></td><td></td>`;
            }

            tbody.appendChild(tr);
        }

        function calculate(input, idSuffix) {
            const val = input.value;
            const days = val === '' ? 0 : parseFloat(val);
            const subsidy = days * dailySubsidy;
            document.getElementById(`subsidy_${idSuffix}`).innerText = subsidy; // No rounding needed for integers, but maybe for floats
            updateTotal();
        }

        function updateTotal() {
            let total = 0;
            // Iterate all potential rows
            for (let i = 0; i < maxRows; i++) {
                // Left
                const leftSub = document.getElementById(`subsidy_left_${i}`);
                if (leftSub) total += parseFloat(leftSub.innerText) || 0;
                
                // Right
                const rightSub = document.getElementById(`subsidy_right_${i}`);
                if (rightSub) total += parseFloat(rightSub.innerText) || 0;
            }
            document.getElementById('grandTotal').innerText = total;
        }

        function downloadExcel() {
            const month = document.getElementById('monthInput').value.trim();
            const filename = `楼庄子水库管理站食堂花名册(${month || 'xx'}月).xlsx`;
            
            // Construct data array manually to capture input values
            const data = [];
            
            // Title
            data.push([`楼庄子水库管理站食堂花名册(${month})月`, null, null, null, null, null, null, null, null, null]);
            
            // Header
            data.push(['序号', '姓名', '在岗天数', '补助(元)', '备注', '序号', '姓名', '在岗天数', '补助(元)', '备注']);
            
            // Rows
            for (let i = 0; i < maxRows; i++) {
                const row = [];
                
                // Left Side
                if (i < leftData.length) {
                    const id = leftData[i].id;
                    const name = leftData[i].name;
                    const daysInput = document.getElementById(`days_left_${i}`);
                    const days = daysInput ? (parseFloat(daysInput.value) || 0) : 0;
                    const subsidyEl = document.getElementById(`subsidy_left_${i}`);
                    const subsidy = subsidyEl ? (parseFloat(subsidyEl.innerText) || 0) : 0;
                    const noteInput = document.getElementById(`note_left_${i}`);
                    const note = noteInput ? noteInput.value : '';
                    
                    row.push(id, name, days, subsidy, note);
                } else {
                    row.push(null, null, null, null, null);
                }
                
                // Right Side
                if (i < rightData.length) {
                    const id = rightData[i].id;
                    const name = rightData[i].name;
                    const daysInput = document.getElementById(`days_right_${i}`);
                    const days = daysInput ? (parseFloat(daysInput.value) || 0) : 0;
                    const subsidyEl = document.getElementById(`subsidy_right_${i}`);
                    const subsidy = subsidyEl ? (parseFloat(subsidyEl.innerText) || 0) : 0;
                    const noteInput = document.getElementById(`note_right_${i}`);
                    const note = noteInput ? noteInput.value : '';
                    
                    row.push(id, name, days, subsidy, note);
                } else {
                    row.push(null, null, null, null, null);
                }
                
                data.push(row);
            }
            
            // Footer
            const total = document.getElementById('grandTotal').innerText;
            data.push(['站领导签字:', null, null, null, null, '报账员:', null, '合计', parseFloat(total) || 0, null]);

            // Create Worksheet
            const ws = XLSX.utils.aoa_to_sheet(data);
            
            // Merge Cells for Title
            if(!ws['!merges']) ws['!merges'] = [];
            ws['!merges'].push({ s: { r: 0, c: 0 }, e: { r: 0, c: 9 } }); // Merge Title across 10 columns
            
            // Create Workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "花名册");
            
            // Write File
            XLSX.writeFile(wb, filename);
        }

        // Initial Total Calculation
        updateTotal();

    </script>
</body>
</html>